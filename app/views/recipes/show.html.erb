<%= render partial: "recipes/tabs" %>

<% if user_signed_in? %>

  <% if @recipe.owned_by?(current_user) %>
    <%= link_to 'Edit', edit_recipe_path(@recipe), class: "btn btn-outline-primary" %>
  <% end %>
  <div style="display: inline-block;"></div>
  <% user_recipe = @recipe.user_recipe_for(current_user) %>
  <% if user_signed_in? and user_recipe %>
    <%= button_to "Enlever de mes recettes", user_recipe, class: "btn btn-outline-primary", method: :delete, data: {confirm: 'Are you sure?'}, form: {style: 'display:inline-block;'} %>
  <% else %>
    <%= form_with(model: UserRecipe.new, class: "inline") do |form| %>
      <%= form.hidden_field :recipe_id, value: @recipe.id %>
      <%= form.submit "Ajouter à mes recettes", class: "btn btn-outline-primary" %>
    <% end %>
  <% end %>
  <button type="button" class="btn btn-outline-secondary" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
    Ajouter à mon calendrier
  </button>
  <div style="height: 10px;"></div>
  <% if user_signed_in? %>
    <% machine = current_user.machines.first_or_create %>
    <div class="collapse" id="collapseExample">
      <%= render partial: "meals/calendar", locals: {recipe: @recipe, machine: machine, meals: machine.meals.includes(:recipe) } %>
      <div style="height: 10px;"></div>
    </div>
  <% end %>
<% end %>
<%# form_with(url: 'TODO', local: true, class: 'inline') do |form| %>
  <%# form.collection_select :unit_system, UnitSystem.all, :id, :name, selected: params[:unit_system_id], class: 'inline' %>
  <%# end %>

<%= render partial: "recipes/recipe_full" %>
