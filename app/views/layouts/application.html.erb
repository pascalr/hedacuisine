<!DOCTYPE html>
<html>
  <head>
    <% title = yield(:title) %>
    <% title = title.blank? ? "HedaCuisine â€“ Robot garde-manger" : title %>
    <title><%= title %></title>
    <% if user_signed_in? %>
      <%= csrf_meta_tags %>
    <% end %>
    <%= csp_meta_tag %>
    <meta charset="utf-8"/>
    <%= stylesheet_link_tag 'application', media: 'all' %>
    <%= javascript_pack_tag 'application' %>
    <%= javascript_pack_tag 'autocomplete' %>
    <%# javascript_pack_tag "autocomplete_search" %>
    <%= javascript_pack_tag "whole_page_search" %>
    <%= stylesheet_pack_tag 'autocomplete' %>
    <link href='https://fonts.googleapis.com/css?family=Caveat' rel='stylesheet'>
    <%# favicon_link_tag asset_path("logo.png") %>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <% description = yield(:description) %>
    <% unless description.blank? %>
      <meta name="description" content="<%= description %>">
    <% end %>
    <meta property="og:locale" content="<%= current_region.locale_with_underscore %>">
    <%= yield(:og_tags) %>
  </head>
  <body>
    <div id="top-search-container" class="top-search-container">
      <% links = Recipe.all_main.all_for(current_user).order(:name).map {|r| {label: r.name, url: recipe_path(r)} }.to_json %>
      <span id="search-list" data-values="<%= links %>"/>
        <%# form_with(url: search_index_path, class: "form-inline", local: true, method: :get) do |form| %>
          <%= search_field_tag :search, nil, id: "top-search", placeholder: "#{t_no_span("heda.search")}...", 'aria-lable': "Search", 'data-autocomplete-links': 'search-list', value: params[:search] %>
          <% if false && user_signed_in?  %>
            <%= form.submit "Search", type: :image, src: asset_path('search.svg'), style: "width: 20px; height: 20px; margin-right: 5px;" %>
          <% else %>
            <%= image_tag asset_path('search.svg'), class: "search-image", style: "width: 20px; height: 20px; margin-right: 5px; transform: translate(0px, -5px);" %>
          <% end %>
        <%# end %>
    </div>
    <div id="whole-page-search">
      <div style="height: 60px;"></div>
      <%# image_tag asset_path('x-lg-white.svg'), class: "close-search", style: "width: 8vw; transform: translate(86vw, 6vh);" %>
      <div style="transform: translateX(calc(50vw - 50%)); height: calc(100% - 60px); overflow: auto; scrollbar-color: #555 #888;">
        <ul id="search-results">
        </ul>
      </div>
    </div>
    <span id="region" hidden><%= current_region.code %></span>
    <div class="responsive-margins-lg">
      <div style="min-height: 100%;">
        <%= render partial: 'layouts/navbar' %>

        <% unless flash.empty? %>
          <script type="text/javascript">
            <% flash.each do |f| %>
              <% type = f[0].to_s.gsub('alert', 'error').gsub('notice', 'info') %>
          	  toastr['<%= type %>']('<%= (simple_format f[1]).gsub(/[\n\r\']/, '').html_safe %>');
            <% end %>
          </script>
        <% end %>

        <div class="root">
          <%= yield %>
        </div>
      </div>

      <footer>
        <small style="margin-left: 1rem;">&copy; Copyright <%= Date.current.year%>, Pascal Rainville</small>
      </footer>        
    </div>
    <%# javascript_pack_tag 'autocomplete_pack' %>

    <script async src="//static.getclicky.com/101337754.js"></script>
    <noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/101337754ns.gif" /></p></noscript>

  </body>
  <%= content_for :render_async %>
</html>
